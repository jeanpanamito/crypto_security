{% extends 'crypto_app/base.html' %}

{% block title %}Algoritmos de Cifrado{% endblock %}

{% block content %}
<div class="hero animate-in">
    <h1>üîê Algoritmos de Cifrado</h1>
    <p>Explora diferentes algoritmos criptogr√°ficos: desde cl√°sicos hasta implementaciones modernas</p>
</div>

<div class="grid-2">
    <!-- Cifrado C√©sar -->
    <div class="card animate-in">
        <div class="card-header">
            <div class="card-icon">üÖ∞Ô∏è</div>
            <div>
                <h3 class="card-title">Cifrado C√©sar</h3>
                <p class="card-subtitle">Sustituci√≥n monoalfab√©tica</p>
            </div>
        </div>

        <div class="info-box">
            <strong>F√≥rmula:</strong> C = (P + K) mod 26<br>
            <small>Donde P = texto plano, K = desplazamiento, C = texto cifrado</small>
        </div>

        <div class="form-group">
            <label>Mensaje</label>
            <textarea id="caesar-input"
                placeholder="Escribe tu mensaje...">El r√°pido zorro marr√≥n salta sobre el perro perezoso</textarea>
        </div>

        <div class="form-group">
            <label>Desplazamiento (1-25)</label>
            <input type="number" id="caesar-shift" value="3" min="1" max="25">
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="caesar('encrypt')">üîí Cifrar</button>
            <button class="btn btn-secondary" onclick="caesar('decrypt')">üîì Descifrar</button>
        </div>

        <div class="form-group" style="margin-top: 1rem;">
            <label>Resultado</label>
            <div id="caesar-output" class="output">...</div>
        </div>
    </div>

    <!-- LFSR -->
    <div class="card animate-in" style="animation-delay: 0.1s">
        <div class="card-header">
            <div class="card-icon">üîÑ</div>
            <div>
                <h3 class="card-title">LFSR (Acarreo)</h3>
                <p class="card-subtitle">Cifrado de flujo</p>
            </div>
        </div>

        <div class="info-box">
            <strong>Linear Feedback Shift Register:</strong> Genera una secuencia pseudoaleatoria que se combina (XOR)
            con el texto.
        </div>

        <div class="form-group">
            <label>Mensaje</label>
            <textarea id="lfsr-input" placeholder="Escribe tu mensaje...">Mensaje secreto para LFSR</textarea>
        </div>

        <div class="form-group">
            <label>Semilla (hex, ej: ACE1)</label>
            <input type="text" id="lfsr-seed" value="ACE1" placeholder="ACE1">
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="lfsr('encrypt')">üîí Cifrar</button>
            <button class="btn btn-secondary" onclick="lfsr('visualize')">üëÅÔ∏è Visualizar</button>
        </div>

        <div class="form-group" style="margin-top: 1rem;">
            <label>Resultado</label>
            <div id="lfsr-output" class="output">...</div>
        </div>
    </div>

    <!-- AES -->
    <div class="card animate-in" style="animation-delay: 0.2s">
        <div class="card-header">
            <div class="card-icon">üèõÔ∏è</div>
            <div>
                <h3 class="card-title">AES</h3>
                <p class="card-subtitle">Advanced Encryption Standard</p>
            </div>
        </div>

        <div class="info-box">
            <strong>Est√°ndar actual:</strong> Cifrado de bloque de 128 bits con claves de 128/192/256 bits. Usa rondas
            de SubBytes, ShiftRows, MixColumns y AddRoundKey.
        </div>

        <div class="form-group">
            <label>Mensaje</label>
            <textarea id="aes-input">Este es un mensaje para cifrar con AES</textarea>
        </div>

        <div class="form-group">
            <label>Clave (16 caracteres para AES-128)</label>
            <input type="text" id="aes-key" value="MiClaveSecreta16">
        </div>

        <div class="form-group">
            <label>Modo</label>
            <select id="aes-mode">
                <option value="CBC">CBC (recomendado)</option>
                <option value="ECB">ECB (inseguro para patrones)</option>
                <option value="CTR">CTR (contador)</option>
            </select>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="aes('encrypt')">üîí Cifrar</button>
            <button class="btn btn-secondary" onclick="aes('info')">üìñ Info T√©cnica</button>
        </div>

        <div class="form-group" style="margin-top: 1rem;">
            <label>Resultado</label>
            <div id="aes-output" class="output">...</div>
        </div>
    </div>

    <!-- Algoritmo Sim√©trico Propio -->
    <div class="card animate-in" style="animation-delay: 0.3s">
        <div class="card-header">
            <div class="card-icon">‚öôÔ∏è</div>
            <div>
                <h3 class="card-title">CipherX (Propio)</h3>
                <p class="card-subtitle">Algoritmo sim√©trico educativo</p>
            </div>
        </div>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Solo educativo:</strong> Este algoritmo demuestra conceptos de S-Box, P-Box y rondas. NO usar en
            producci√≥n.
        </div>

        <div class="form-group">
            <label>Mensaje</label>
            <textarea id="symmetric-input">Texto para CipherX</textarea>
        </div>

        <div class="form-group">
            <label>Clave (8 caracteres)</label>
            <input type="text" id="symmetric-key" value="ClaveXYZ" maxlength="8">
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" onclick="customSymmetric('encrypt')">üîí Cifrar</button>
            <button class="btn btn-secondary" onclick="customSymmetric('decrypt')">üîì Descifrar</button>
            <button class="btn btn-secondary" onclick="customSymmetric('info')">üìñ Info</button>
        </div>

        <div class="form-group" style="margin-top: 1rem;">
            <label>Resultado</label>
            <div id="symmetric-output" class="output">...</div>
        </div>
    </div>
</div>

<!-- Algoritmo Asim√©trico -->
<div class="card animate-in" style="animation-delay: 0.4s; margin-top: 1.5rem;">
    <div class="card-header">
        <div class="card-icon">üîë</div>
        <div>
            <h3 class="card-title">SimpleRSA (Asim√©trico Propio)</h3>
            <p class="card-subtitle">Demostraci√≥n de criptograf√≠a de clave p√∫blica</p>
        </div>
    </div>

    <div class="grid-2">
        <div>
            <div class="info-box">
                <strong>RSA simplificado:</strong> Usa n√∫meros primos peque√±os para demostrar el concepto.
                <br><br>
                <strong>F√≥rmulas:</strong><br>
                ‚Ä¢ n = p √ó q<br>
                ‚Ä¢ œÜ(n) = (p-1)(q-1)<br>
                ‚Ä¢ e √ó d ‚â° 1 (mod œÜ(n))<br>
                ‚Ä¢ Cifrado: c = m<sup>e</sup> mod n<br>
                ‚Ä¢ Descifrado: m = c<sup>d</sup> mod n
            </div>

            <div class="form-group">
                <label>Mensaje</label>
                <input type="text" id="asymmetric-input" value="Hola">
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="customAsymmetric('generate')">üîë Generar Claves</button>
                <button class="btn btn-secondary" onclick="customAsymmetric('encrypt')">üîí Cifrar</button>
                <button class="btn btn-secondary" onclick="customAsymmetric('visualize')">üëÅÔ∏è Visualizar</button>
            </div>
        </div>
        <div>
            <label>Resultado</label>
            <div id="asymmetric-output" class="output" style="min-height: 200px;">...</div>
        </div>
    </div>
</div>

<!-- Comparativa -->
<div class="card animate-in" style="animation-delay: 0.5s; margin-top: 1.5rem;">
    <div class="card-header">
        <div class="card-icon">üìä</div>
        <div>
            <h3 class="card-title">Comparativa de Algoritmos</h3>
            <p class="card-subtitle">Ventajas y desventajas t√©cnicas</p>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Algoritmo</th>
                <th>Tipo</th>
                <th>Seguridad</th>
                <th>Velocidad</th>
                <th>Uso Recomendado</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="badge badge-danger">C√©sar</span></td>
                <td>Sustituci√≥n</td>
                <td>‚ùå Muy d√©bil (26 claves)</td>
                <td>‚ö° Muy r√°pido</td>
                <td>Solo educativo</td>
            </tr>
            <tr>
                <td><span class="badge badge-warning">LFSR</span></td>
                <td>Flujo</td>
                <td>‚ö†Ô∏è D√©bil si se conoce estructura</td>
                <td>‚ö° Muy r√°pido</td>
                <td>Hardware, streams</td>
            </tr>
            <tr>
                <td><span class="badge badge-success">AES-256</span></td>
                <td>Bloque sim√©trico</td>
                <td>‚úÖ Muy seguro</td>
                <td>‚ö° R√°pido (aceleraci√≥n HW)</td>
                <td>Est√°ndar actual</td>
            </tr>
            <tr>
                <td><span class="badge badge-success">RSA-2048+</span></td>
                <td>Asim√©trico</td>
                <td>‚úÖ Seguro</td>
                <td>üê¢ Lento</td>
                <td>Intercambio de claves, firmas</td>
            </tr>
            <tr>
                <td><span class="badge badge-primary">ChaCha20</span></td>
                <td>Flujo moderno</td>
                <td>‚úÖ Muy seguro</td>
                <td>‚ö° Muy r√°pido (software)</td>
                <td>TLS 1.3, m√≥viles</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function caesar(action) {
        const text = document.getElementById('caesar-input').value;
        const shift = document.getElementById('caesar-shift').value;
        showLoading('caesar-output');

        const result = await apiCall('/api/caesar/', {
            action: action,
            text: text,
            shift: parseInt(shift)
        });

        if (result.error) {
            showOutput('caesar-output', result.error, true);
        } else {
            showOutput('caesar-output', `Resultado: ${result.result}`);
        }
    }

    async function lfsr(action) {
        const text = document.getElementById('lfsr-input').value;
        const seed = document.getElementById('lfsr-seed').value;
        showLoading('lfsr-output');

        const result = await apiCall('/api/lfsr/', {
            action: action,
            text: text,
            seed: seed
        });

        if (result.error) {
            showOutput('lfsr-output', result.error, true);
        } else {
            showOutput('lfsr-output', JSON.stringify(result.result, null, 2));
        }
    }

    async function aes(action) {
        const text = document.getElementById('aes-input').value;
        const key = document.getElementById('aes-key').value;
        const mode = document.getElementById('aes-mode').value;
        showLoading('aes-output');

        const result = await apiCall('/api/aes/', {
            action: action,
            text: text,
            key: key,
            mode: mode
        });

        if (result.error) {
            showOutput('aes-output', result.error, true);
        } else {
            showOutput('aes-output', JSON.stringify(result.result, null, 2));
        }
    }

    async function customSymmetric(action) {
        const text = document.getElementById('symmetric-input').value;
        const key = document.getElementById('symmetric-key').value;
        showLoading('symmetric-output');

        const result = await apiCall('/api/custom-symmetric/', {
            action: action,
            text: text,
            key: key
        });

        if (result.error) {
            showOutput('symmetric-output', result.error, true);
        } else {
            showOutput('symmetric-output', JSON.stringify(result.result, null, 2));
        }
    }

    async function customAsymmetric(action) {
        const text = document.getElementById('asymmetric-input').value;
        showLoading('asymmetric-output');

        const result = await apiCall('/api/custom-asymmetric/', {
            action: action,
            text: text
        });

        if (result.error) {
            showOutput('asymmetric-output', result.error, true);
        } else {
            let output;
            if (action === 'generate') {
                const r = result.result;
                output = `GENERACI√ìN DE CLAVES RSA
${'='.repeat(35)}
Primos:
  p = ${r.p}
  q = ${r.q}

M√≥dulo:
  n = p √ó q = ${r.n}
  œÜ(n) = ${r.phi_n}

Exponentes:
  e (p√∫blico) = ${r.e}
  d (privado) = ${r.d}

Claves:
  P√∫blica:  ${r.public_key}
  Privada:  ${r.private_key}`;
            } else {
                output = JSON.stringify(result.result, null, 2);
            }
            showOutput('asymmetric-output', output);
        }
    }
</script>
{% endblock %}